:root{
  --primary-purple:#6e44ff;
  --light-purple:#e7e0ff;
  --dark-text:#333;
  --light-text:#666;
  --background-color:#fdfdff;
  --border-color:#e0e0e0;
  --delete-red:#ff3b30;
  --leaf-green:#2E7D32;
  --leaf-yellow:#FFC107;
  --track:#efe9ff;
  --fill:#4b3aa6;
  --overdue-red:#b00020;
  --overdue-bg:#fde8e8;
}

*{box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;margin:0;background:#222;display:flex;justify-content:center;padding-top:20px}
#app-container{width:412px;height:892px;background:var(--background-color);border-radius:40px;border:1px solid #444;box-shadow:0 0 30px rgba(255,255,255,.1);overflow:hidden;display:flex;flex-direction:column;position:relative}
.hidden{display:none !important}

.view{display:flex;flex-direction:column;height:100%}
.app-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid var(--border-color);background:var(--background-color);z-index:10}
.icon-button{background:none;border:0;font-size:1.5em;cursor:pointer}

.mindful-break-chip{background:var(--light-purple);color:var(--primary-purple);padding:6px 12px;border-radius:20px;font-weight:500;cursor:pointer;display:flex;gap:6px;align-items:center}
.task-list-container{padding:20px;overflow:auto}

.task-item{background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:12px;display:flex;gap:12px;margin-bottom:10px;align-items:flex-start}
.task-item .checkbox{width:22px;height:22px;border:2px solid var(--border-color);border-radius:4px;display:flex;justify-content:center;align-items:center;cursor:pointer;flex-shrink:0}
.task-item.completed .checkbox{background:var(--primary-purple);border-color:var(--primary-purple);color:#fff}
.task-item-content h3{margin:0 0 4px 0;font-size:1em}
.task-item-content p{margin:0;color:var(--light-text);font-size:.9em}
.task-item.completed .task-item-content h3{text-decoration:line-through;color:var(--light-text)}
.right-icon{margin-left:auto;cursor:pointer;font-size:1.1em;line-height:1em;padding:6px}
.task-item.completed .right-icon{color:var(--delete-red)}
.status-line{margin-top:4px;color:var(--dark-text);font-size:.85em;display:flex;gap:6px;align-items:center}

.fab{position:absolute;bottom:30px;right:30px;width:56px;height:56px;border-radius:50%;border:0;background:var(--primary-purple);color:#fff;font-size:2em;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.2)}

.tree-container-wrapper{flex:1;position:relative;overflow:hidden;background:#f1f5f1}
#task-animation-bg{position:absolute;inset:0;background:#f0f4f0;background-size:cover;background-position:center;z-index:1}
#leaf-fall-container{position:absolute;inset:0;z-index:2;pointer-events:none}

/* Request 1: projection text */
.projection-msg{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  color:#d32f2f;font-weight:700;text-align:center;padding:0 16px;z-index:3;pointer-events:none;
}

/* Reminder toast */
.reminder-toast{
  position:absolute;left:50%;bottom:120px;transform:translateX(-50%);
  z-index:5;pointer-events:none;
}
.toast-content{
  background:#ffffff; border:1px solid #e6ddff; box-shadow:0 10px 30px rgba(0,0,0,.12);
  border-radius:12px; padding:10px 14px; color:#5a36ff; font-weight:700; display:flex; align-items:center; gap:8px;
}
.toast-bell{font-size:18px}

/* Footer */
.task-footer{padding:16px 20px;border-top:1px solid var(--border-color);background:var(--background-color);z-index:10}
.time-remaining{font-size:1.4em;font-weight:700;margin-bottom:6px}
.time-remaining.overdue{color:var(--overdue-red)}

.overdue-badge{display:flex;gap:8px;align-items:center;justify-content:center;background:var(--overdue-bg);color:var(--overdue-red);padding:10px;border-radius:12px;margin:8px 0;font-weight:700}
.overdue-badge .exclam{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--overdue-red);color:#fff;font-weight:800;font-size:.8em}

.labels-row{display:flex;justify-content:space-between;color:var(--light-text);font-size:.9em;margin-bottom:8px}
.bell{margin-right:4px}

.progress-bar-container{position:relative;height:12px;border-radius:6px;background:transparent;margin-bottom:12px}
.progress-track{position:absolute;inset:0;background:var(--track);border-radius:6px}
.progress-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:var(--fill);border-radius:6px;transition:width .2s linear}
.progress-bar-container.overdue .progress-track{background:var(--overdue-bg)}
.progress-bar-container.overdue .progress-fill{background:var(--overdue-red)}

.reminder-dots{position:absolute;inset:0;pointer-events:none}
.reminder-dot{position:absolute;top:50%;transform:translate(-50%,-50%);width:6px;height:6px;border-radius:50%;background:#6f5ccf}

.underbar-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.checkbox-lg{width:22px;height:22px;border-radius:4px;border:2px solid var(--border-color);background:#fff;cursor:pointer}
.checkbox-lg.checked{background:var(--primary-purple);border-color:var(--primary-purple);color:#fff}
.underbar-info h3{margin:0 0 2px 0}
.underbar-info .under-duration{margin:0;color:var(--light-text);font-size:.9em}
.edit-inline{margin-left:auto;background:none;border:0;cursor:pointer;font-size:1.2em}

.task-controls{display:flex;gap:10px}
.primary-button,.secondary-button,.delete-button{flex:1;padding:12px 14px;border-radius:8px;border:0;font-weight:700;cursor:pointer}
.primary-button{background:var(--primary-purple);color:#fff}
.secondary-button{background:#eee;color:var(--dark-text)}
.delete-button{background:#eee;color:var(--delete-red)}

/* Edit screen */
.form-container{padding:20px;display:flex;flex-direction:column;gap:12px;flex:1;min-height:0;overflow:auto}
.field-label{font-weight:600;color:var(--dark-text)}
.duration-input{display:flex;align-items:center;gap:10px;font-weight:700;flex-wrap:wrap}
.duration-input input{width:64px;text-align:center;font-size:1.2em;background:#f4f4f4;border:0;border-radius:8px;padding:6px}
.duration-input span{color:var(--light-text)}

.reminder-section{border-top:1px solid var(--border-color);padding-top:8px}
.reminder-title{font-weight:600;margin-bottom:6px;color:var(--dark-text)}
.reminder-list{display:flex;flex-direction:column;border:1px solid var(--border-color);border-radius:10px;overflow:hidden}
.rem-row{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--border-color);cursor:pointer}
.rem-row:last-child{border-bottom:none}
.rem-row input[type="checkbox"]{appearance:none;width:18px;height:18px;border:2px solid var(--primary-purple);border-radius:50%;position:relative}
.rem-row input[type="checkbox"]:checked{background:var(--primary-purple)}
.rem-row input[type="checkbox"]:disabled{opacity:.35;cursor:not-allowed}
.link-button{background:#fff;border:1px dashed var(--border-color);border-radius:8px;padding:8px 10px;color:var(--primary-purple);font-weight:600;cursor:pointer}
.rem-row .remove-rem{margin-left:auto;background:#eee;border:0;border-radius:8px;padding:6px 8px;cursor:pointer;color:#555}
.rem-row.custom span{font-style:italic}

.edit-footer{padding:12px 20px;display:flex;flex-direction:column;gap:10px}
.link-danger{background:none;border:none;color:var(--delete-red);text-align:left;font-weight:700;cursor:pointer;padding:6px 0}
.edit-actions{display:flex;gap:10px}
.restart-btn{width:100%}

/* Overlays */
.overlay{position:absolute;inset:0;background:rgba(255,255,255,.75);backdrop-filter:blur(6px);display:flex;justify-content:center;align-items:center;z-index:200}
.overlay-card{background:#fff;border-radius:12px;padding:20px;width:80%;max-width:340px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.15)}
.overlay-card .overlay-title{margin:0 0 12px 0;font-weight:700}
.overlay-card .subtle{color:var(--light-text);margin:8px 0 12px 0}
.overdue-card{background:var(--overdue-bg)}
.overlay.clear{background:transparent;backdrop-filter:none;pointer-events:none}
.overlay.clear .overlay-card{pointer-events:auto}

/* Deleted overlay */
.overlay-list{max-height:55vh;overflow:auto;text-align:left}
.deleted-item{display:flex;gap:10px;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border-color)}
.deleted-item .meta{color:var(--light-text);font-size:.85em}
.restore-btn{background:#eee;border:0;border-radius:8px;padding:6px 10px;cursor:pointer}

/* Leaves (shaky) */
.leaf{position:absolute;width:26px;height:30px;color:#000;fill:var(--leaf-green);opacity:0;animation-iteration-count:1;will-change:transform;animation-name:fall;animation-timing-function:cubic-bezier(0.55,0.085,0.68,0.53)}
.leaf path{stroke:#1c1c1c;stroke-width:1.2;stroke-linecap:round;stroke-linejoin:round}
.leaf.yellow{fill:var(--leaf-yellow);transform:scale(1.08);z-index:10}
.leaf.swirl-green{animation-name:swirl-green}
.leaf.swirl-yellow{animation-name:swirl-yellow;animation-timing-function:ease-in-out}
.leaf-inner{transform-origin:50% 50%;animation:flutter var(--flutter-speed,1200ms) ease-in-out infinite}

/* Path animations and flutter */
@keyframes fall{0%{transform:translateY(0) translateX(0) rotate(0);opacity:1}100%{transform:translateY(90vh) translateX(var(--x-end)) rotate(var(--rotate-end));opacity:0}}
@keyframes swirl-green{0%{transform:translate(var(--x-start),-10vh) rotate(0);opacity:0}20%{opacity:1}100%{transform:translate(var(--x-end),100vh) rotate(720deg);opacity:0}}
@keyframes swirl-yellow{0%{transform:translate(50vw,-10vh) rotate(0) scale(1.08);opacity:0}15%{opacity:1;transform:translate(60vw,20vh) rotate(90deg) scale(1.08)}50%{transform:translate(20vw,50vh) rotate(270deg) scale(1.08)}85%{transform:translate(50vw,80vh) rotate(450deg) scale(1.08)}100%{transform:translate(40vw,100vh) rotate(540deg) scale(1.08);opacity:0}}
@keyframes flutter{0%{transform:rotate(0deg)}20%{transform:rotate(var(--flutter-amp,8deg))}40%{transform:rotate(0deg) scale(1.02)}60%{transform:rotate(calc(var(--flutter-amp,8deg) * -1))}80%{transform:rotate(0deg)}100%{transform:rotate(0deg)}}